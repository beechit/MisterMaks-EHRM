<f:layout name="Ajax"/>{namespace ehrm=Beech\Ehrm\ViewHelpers}

<f:section name="Body">

	<h1>
		<f:translate id="personInfo">Person information</f:translate>
	</h1>

	<div id="c261" class="csc-default">
		<a class="btn" href="{f:uri.action(package:'Beech.Absence', controller:'Absence', action:'new', arguments: {person: person, absenceType: 'sickness'})}"
		   data-toggle="modal-ajax" data-target="#modal" modal-size="large"
		   data-reload="{f:uri.action(package:'Beech.Party', controller:'Person', action:'show', arguments: {person: person})}">
			<i class="icon-ambulance icon-white"></i>
			<f:translate id="sickReport">Sick report</f:translate>
		</a>
		<a class="btn" href="{f:uri.action(package:'Beech.Absence', controller:'Absence', action:'new', arguments: {person: person, absenceType: 'leave'})}"
		   data-toggle="modal-ajax" data-target="#modal" modal-size="large"
		   data-reload="{f:uri.action(package:'Beech.Party', controller:'Person', action:'show', arguments: {person: person})}">
			<i class="icon-ambulance icon-white"></i>
			<f:translate id="leaveRequest">Leave request</f:translate>
		</a>
		<a class="btn" href="{f:uri.action(package:'Beech.Absence', controller:'Absence', action:'list', arguments: {person: person, absenceType: 'sickness'})}"
		   data-toggle="modal-ajax" data-target="#modal" modal-size="large"
		   data-reload="{f:uri.action(package:'Beech.Party', controller:'Person', action:'show', arguments: {person: person})}">
			<i class="icon-ambulance icon-white"></i>
			<f:translate id="sicknessHistory">Sickness history</f:translate>
		</a>
		<a class="btn" href="{f:uri.action(package:'Beech.Absence', controller:'Absence', action:'list', arguments: {person: person, absenceType: 'leave'})}"
		   data-toggle="modal-ajax" data-target="#modal" modal-size="large"
		   data-reload="{f:uri.action(package:'Beech.Party', controller:'Person', action:'show', arguments: {person: person})}">
			<i class="icon-ambulance icon-white"></i>
			<f:translate id="leaveHistory">Leave history</f:translate>
		</a>
		<a class="btn btn-success" href="{f:uri.action(package:'Beech.CLA', subpackage:'Administration', controller:'contract', action:'new', arguments: {employee: person})}"
		   data-toggle="modal-ajax" data-target="#modal-body-only" modal-size="large"
		   data-reload="{f:uri.action(package:'Beech.Party', controller:'Person', action:'show', arguments: {person: person})}">
			<i class="icon-plus icon-white"></i>
			Create contract
		</a>
		<ul id="personTabs" class="nav nav-tabs">
			<li class="active">
				<a data-toggle="tab" href="#general">
					<f:translate id="general">General</f:translate>
				</a>
			</li>
			<li>
				<a data-toggle="tab" href="#education">
					<f:translate id="education>">Education</f:translate>
				</a>
			</li>
			<li>
				<a data-toggle="tab" href="#personal">
					<f:translate id="personal">Personal</f:translate>
				</a>
			</li>
			<li>
				<a data-toggle="tab" href="#contract">
					<f:translate id="contract">Contract</f:translate>
				</a>
			</li>
			<li>
				<a data-toggle="tab" href="#documents">
					<f:translate id="documents">Documents</f:translate>
				</a>
			</li>
			<li>
				<a data-toggle="tab" href="#personRelations">
                  <f:translate id="relatives">Relatives</f:translate></a>
			</li>
		</ul>
		<div id="personTabsContent" class="tab-content">
			<div id="general" class="tab-pane fade active in">
				<f:render partial="Views/Show/Person" arguments="{_all}"/>
				<table id="addresses-{person.id}" class="table table-striped table-bordered">
					<tbody>
					<tr>
						<td class="span6">
							<f:render partial="Views/Show/Address" arguments="{address: person.address_home}"/>
							<ehrm:link.edit subpackage='Administration' controller='Address' action='list'
											arguments='{party: person}'
											dataReload="{f:uri.action(package:'Beech.Party', controller:'Person', action:'show', arguments: {person: person})}"/>
						</td>
						<td class="span6">
							<f:render partial="Views/Show/Address" arguments="{address: person.address_work}"/>
							<ehrm:link.edit subpackage='Administration' controller='Address' action='list'
											arguments='{party: person}'
											dataReload="{f:uri.action(package:'Beech.Party', controller:'Person', action:'show', arguments: {person: person})}"/>
						</td>
					</tr>
					</tbody>
				</table>
			</div>
			<div id="education" class="tab-pane fade">
				<f:for each="{educations}" as="education">
					<div id="education-{education.id}">
						<f:render partial="Views/Show/Education" arguments="{education: education}"/>
					</div>
				</f:for>
				<ehrm:link.edit subpackage='Administration' controller='Education' action='list'
								arguments='{party: person}'
								dataReload="{f:uri.action(package:'Beech.Party', controller:'Person', action:'show', arguments: {person: person})}"/>
			</div>
			<div id="contract" class="tab-pane fade">
				contract...<br/>
			</div>
			<div id="personRelations" class="tab-pane fade">
				<f:for each="{personRelations}" as="personRelation">
					<div id="personRelation-{personRelation.id}">
						<f:render partial="Views/List/PersonRelation" arguments="{_all}"/>
					</div>
				</f:for>
				<ehrm:link.edit subpackage='Administration' controller='PersonRelation' action='new'
								arguments='{personRelatedTo: person}'
								dataReload="{f:uri.action(package:'Beech.Party', controller:'Person', action:'show', arguments: {person: person})}">
					<i class="icon-pencil icon-white"></i> <f:translate id="addRelative">Add relative</f:translate>
				</ehrm:link.edit>
			</div>
			<div id="documents" class="tab-pane fade">
				<div style="position: absolute; height: 100%">
					<f:translate id="filter:">Filter:</f:translate>
					<ehrm:form.select name="documentType" class="documentType" options="{documentCategories}"
									  optionLabelField="typeName"/>

					<style>.chzn-container {
						width: 200px !important;
					}</style>
				</div>

				<table class="table table-striped table-bordered" id="personDocuments">
					<thead>
					<tr>
						<th>
							<f:translate id="name">Name</f:translate>
						</th>
						<th>
							<f:translate id="category">Category</f:translate>
						</th>
						<th>&nbsp;</th>
				</tr>
					</thead>
					<f:for each="{documents}" as="document" iteration="documentIterator">
						<tr>
							<td><a href="#/document/show/{document.id}">{document.name}</a></td>
							<td>
								<f:translate id="document.documentType.{document.documentType.categoryName}">
									{document.documentType.categoryName}
								</f:translate>
								/
								<f:translate id="document.documentType.{document.documentType.typeName}">
									{document.documentType.typeName}
								</f:translate>
								<br/>
								<f:for each="{document.resources}" as="resource">
									<i>{resource.contentType}</i>
								</f:for>
							</td>
							<td>
								<div class="btn-group">
									<button class="btn btn-small">
										<f:translate id="actions">Actions</f:translate>
									</button>
									<button class="btn btn-small dropdown-toggle" data-toggle="dropdown">
										<span class="caret"></span>
									</button>
									<ul class="dropdown-menu">
										<li><a href="/download/{document.id}"><i class="icon-download-alt"></i>
											<f:translate id="download">Download</f:translate>
										</a></li>
										<li><a href="#/document/delete/{document.id}"><i class="icon-trash"></i>
											<f:translate id="remove">Delete</f:translate>
										</a></li>
									</ul>
								</div>
							</td>
						</tr>
					</f:for>
				</table>
				<div style="text-align: right;">
					<ehrm:link.edit id="addDocument" class="btn btn-primary" subpackage='Administration'
									controller='PersonRelation' action='new' arguments='{personRelatedTo: person}'
									dataReload="{f:uri.action(package:'Beech.Party', controller:'Person', action:'show', arguments: {person: person})}">
						<i class="icon-plus icon-white"></i>
						<f:translate id="action.add">Add</f:translate>
					</ehrm:link.edit>
				</div>
			</div>

		</div>
		<script type="text/javascript">
			var oPersonDocumentsTable = $('#personDocuments')
					.dataTable({
						"sDom": 'f',
						"oLanguage": {
							"sEmptyTable": '<f:translate id="document.sEmptyTable">No data available in table</f:translate>',
							"sSearch": '<f:translate id="document.sSearch">Search</f:translate>',
							"sLengthMenu": '<f:translate id="document.sLengthMenu">Show _MENU_ entries</f:translate>',
							"oPaginate": {
								"sFirst": '<f:translate id="document.sFirst">Search</f:translate>',
								"sLast": '<f:translate id="document.sLast">Last</f:translate>',
								"sNext": '<f:translate id="document.sNext">Next</f:translate>',
								"sPrevious": '<f:translate id="document.sPrevious">Previous</f:translate>'
							}
						}
					})
			$('select.documentType').change(function () {
				oPersonDocumentsTable.fnFilter($(this).find('option:selected').text());
			});
			$('#addDocument').on('click', function () {
				$(this).attr('href', $(this).attr('href').replace('person', 'trrr'))
			})
		</script>
</f:section>
