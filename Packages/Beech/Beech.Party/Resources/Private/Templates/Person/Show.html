<f:layout name="Ajax"/>{namespace ehrm=Beech\Ehrm\ViewHelpers}

<f:section name="Body">

	<h1>
		<f:translate id="personInfo">Person information</f:translate>
	</h1>

	<div class="row-fluid content-padding">
		<div class="span12">
			<a class="btn" href="{f:uri.action(package:'Beech.Absence', controller:'Absence', action:'new', arguments: {person: person, absenceType: 'sickness'})}"
			   data-toggle="modal-ajax" data-target="#modal" modal-size="large"
			   data-reload="close-modal">
				<i class="icon-ambulance icon-white"></i>
				<f:translate id="sickReport">Sick report</f:translate>
			</a>
			<a class="btn" href="{f:uri.action(package:'Beech.Absence', controller:'Absence', action:'new', arguments: {person: person, absenceType: 'leave'})}"
			   data-toggle="modal-ajax" data-target="#modal" modal-size="large"
			   data-reload="close-modal">
				<i class="icon-ambulance icon-white"></i>
				<f:translate id="leaveRequest">Leave request</f:translate>
			</a>
			<a class="btn" href="{f:uri.action(package:'Beech.Absence', controller:'Absence', action:'list', arguments: {person: person, absenceType: 'sickness'})}"
			   data-toggle="modal-ajax" data-target="#modal" modal-size="large"
			   data-reload="close-modal">
				<i class="icon-ambulance icon-white"></i>
				<f:translate id="sicknessHistory">Sickness history</f:translate>
			</a>
			<a class="btn" href="{f:uri.action(package:'Beech.Absence', controller:'Absence', action:'list', arguments: {person: person, absenceType: 'leave'})}"
			   data-toggle="modal-ajax" data-target="#modal" modal-size="large"
			   data-reload="close-modal">
				<i class="icon-ambulance icon-white"></i>
				<f:translate id="leaveHistory">Leave history</f:translate>
			</a>
			<a class="btn btn-success" href="{f:uri.action(package:'Beech.CLA', subpackage:'Administration', controller:'contract', action:'new', arguments: {employee: person})}"
			   data-toggle="modal-ajax" data-target="#modal" modal-size="large"
			   data-reload="reload-current-page">
				<i class="icon-plus icon-white"></i>
				Create contract
			</a>
		</div>
	</div>

	<ehrm:flashMessages/>

	<div class="row-fluid">
		<div class="span12">
			<ul id="personTabs" class="nav nav-tabs">
				<li class="active">
					<a data-toggle="tab" href="#general">
						<f:translate id="general">General</f:translate>
					</a>
				</li>
				<li>
					<a data-toggle="tab" href="#education">
						<f:translate id="education>">Education</f:translate>
					</a>
				</li>
				<li>
					<a data-toggle="tab" href="#personal">
						<f:translate id="personal">Personal</f:translate>
					</a>
				</li>
				<li>
					<a data-toggle="tab" href="#contract">
						<f:translate id="contract">Contract</f:translate>
					</a>
				</li>
				<li>
					<a data-toggle="tab" href="#asset">
						<f:translate id="asset">Asset</f:translate>
					</a>
				</li>
				<li>
					<a data-toggle="tab" href="#licence">
						<f:translate id="licence">Licence</f:translate>
					</a>
				</li>
				<li>
					<a data-toggle="tab" href="#documents">
						<f:translate id="documents">Documents</f:translate>
					</a>
				</li>
				<li>
					<a data-toggle="tab" href="#personRelations">
						<f:translate id="relatives">Relatives</f:translate></a>
				</li>
			</ul>
			<div id="personTabsContent" class="tab-content">
				<div id="general" class="tab-pane fade active in">
					<f:render partial="Views/Show/Person" arguments="{_all}"/>
					<table id="addresses-{person.id}" class="table table-striped table-bordered">
						<tbody>
						<tr>
							<td class="span6">
								<f:render partial="Views/Show/Address" arguments="{address: person.address_homeAddress}"/>
								<ehrm:link.edit controller='Address' action='list'
												arguments='{party: person}'
												dataReload="reload-current-page" count="<f:count subject='{addresses}'/>"/>
							</td>
							<td class="span6">
								<f:render partial="Views/Show/Address" arguments="{address: person.address_workAddress}"/>
								<ehrm:link.edit controller='Address' action='list'
												arguments='{party: person}'
												dataReload="reload-current-page" count="<f:count subject='{addresses}'/>"/>
							</td>
						</tr>
						</tbody>
					</table>
				</div>
				<div id="personal" class="tab-pane fade">
				</div>
				<div id="education" class="tab-pane fade">
					<f:for each="{educations}" as="education">
						<div id="education-{education.id}">
							<f:render partial="Views/Show/Education" arguments="{education: education}"/>
						</div>
					</f:for>
					<ehrm:link.edit controller='Education' action='list'
									arguments='{party: person}'
									dataReload="reload-current-page" count="<f:count subject='{educations}'/>"/>
				</div>
				<div id="contract" class="tab-pane fade">
					<f:render partial="Beech.CLA:Views/List/Contract" arguments="{_all}"/>
				</div>
				<div id="asset" class="tab-pane fade">
					<f:for each="{assets}" as="asset">
						<div id="asset-{asset.id}">
							<f:render partial="Views/Show/Asset" arguments="{asset: asset}"/>
						</div>
					</f:for>
					<ehrm:link.edit controller='Asset' action='list'
									arguments='{party: person}'
									dataReload="reload-current-page" count="<f:count subject='{assets}'/>"/>
				</div>
				<div id="licence" class="tab-pane fade">
					<f:for each="{licences}" as="licence">
						<div id="licence-{licence.id}">
							<f:render partial="Views/Show/Licence" arguments="{licence: licence}"/>
						</div>
					</f:for>
					<ehrm:link.edit controller='Licence' action='list'
									arguments='{party: person}'
									dataReload="reload-current-page" count="<f:count subject='{licences}'/>"/>
				</div>
				<div id="personRelations" class="tab-pane fade">
					<f:for each="{personRelations}" as="personRelation">
						<div id="personRelation-{personRelation.id}">
							<f:render partial="Views/List/PersonRelation" arguments="{_all}"/>
						</div>

					</f:for>
					<ehrm:link.edit controller='PersonRelation' action='new'
									arguments='{personRelatedTo: person}'
									dataReload="reload-current-page" count="<f:count subject='{personRelations}'/>">
						<i class="icon-plus icon-white"></i>
						<f:translate id="action.add">Add</f:translate>
					</ehrm:link.edit>
				</div>
				<div id="documents" class="tab-pane fade">
					<div style="position: absolute; height: 100%">
						<f:translate id="filter:">Filter:</f:translate>
						<ehrm:form.select name="documentType" class="documentType" options="{documentCategories}"
										  optionLabelField="typeName"/>

						<style>.chzn-container {
							width: 200px !important;
						}</style>
					</div>

					<table class="table table-striped table-bordered" id="personDocuments">
						<thead>
						<tr>
							<th>
								<f:translate id="name">Name</f:translate>
							</th>
							<th>
								<f:translate id="category">Category</f:translate>
							</th>
							<th>
								<f:translate id="mimeType">Type</f:translate>
							</th>
							<th>&nbsp;</th>
						</tr>
						</thead>
						<f:for each="{documents}" as="document" iteration="documentIterator">
							<tr>
								<td><a href="#/document/show/{document.id}">{document.name}</a></td>
								<td>
									<f:translate id="document.documentType.categoryName.{document.documentType.categoryName}" package="Beech.Document">
										{document.documentType.categoryName}
									</f:translate>
									/
									<strong></strong><f:translate id="document.documentType.typeName.{document.documentType.typeName}" package="Beech.Document">
										{document.documentType.typeName}
									</f:translate></
								</td>
								<td>
									<f:for each="{document.resources}" as="resource">
										<i><f:translate id="resource.contentType.{resource.contentType}" package="Beech.Document">
											{resource.contentType}
										</f:translate></i>
									</f:for>
								</td>
								<td>
									<div class="btn-group">
										<button class="btn btn-small">
											<f:translate id="actions">Actions</f:translate>
										</button>
										<button class="btn btn-small dropdown-toggle" data-toggle="dropdown">
											<span class="caret"></span>
										</button>
										<ul class="dropdown-menu">
											<li><a href="/download/{document.id}"><i class="icon-download-alt"></i>
												<f:translate id="download">Download</f:translate>
											</a></li>
											<li><a href="#/document/delete/{document.id}"><i class="icon-trash"></i>
												<f:translate id="remove">Delete</f:translate>
											</a></li>
										</ul>
									</div>
								</td>
							</tr>
						</f:for>
					</table>
					<div style="text-align: right; margin-top: 20px">
						<ehrm:link.edit id="addDocument" class="btn btn-primary" package="Beech.Document"
										controller='Document' action='new' arguments='{party: person}'
										dataReload="reload-current-page">
							<i class="icon-plus icon-white"></i>
							<f:translate id="action.add">Add</f:translate>
						</ehrm:link.edit>
					</div>
					<hr>
				</div>

			</div>
		</div>
	</div>


		<script type="text/javascript">
			var oPersonDocumentsTable = $('#personDocuments')
					.dataTable({
						"sDom": 'f',
						"oLanguage": {
							"sEmptyTable": '<f:translate id="document.sEmptyTable">No data available in table</f:translate>',
							"sSearch": '<f:translate id="document.sSearch">Search</f:translate>',
							"sLengthMenu": '<f:translate id="document.sLengthMenu">Show _MENU_ entries</f:translate>',
							"oPaginate": {
								"sFirst": '<f:translate id="document.sFirst">Search</f:translate>',
								"sLast": '<f:translate id="document.sLast">Last</f:translate>',
								"sNext": '<f:translate id="document.sNext">Next</f:translate>',
								"sPrevious": '<f:translate id="document.sPrevious">Previous</f:translate>'
							}
						}
					})
			$('select.documentType').change(function () {
				oPersonDocumentsTable.fnFilter($(this).find('option:selected').text());
			});
		</script>
</f:section>
